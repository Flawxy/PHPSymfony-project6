{% extends 'base.html.twig' %}

{% block title %}{{ trick.name | capitalize }}{% endblock %}

{% block body %}
<div class="container">
    <div class="row">
        <h1>{{ trick.name | capitalize }}</h1>
        {% if app.user %}
            <div>
                <a href="{{ path('tricks_edit', {'slug' : trick.slug}) }}">
                    <span class="fas fa-pencil-alt text-info"></span>
                </a>
                <a href="{{ path('tricks_delete', {'slug' : trick.slug}) }}"
                   onclick="return confirm(`Êtes-vous sûr de vouloir supprimer la figure {{ trick.name }} ?`)">
                    <span class="far fa-trash-alt text-danger"></span>
                </a>
            </div>
        {% endif %}
    </div>

    <div class="mb-3">
        {% if app.user %}
            <div class="float-right">
                <a href="{{ path('cover_edit', {'id' : trick.id}) }}">
                    <span class="fas fa-pencil-alt text-info"></span>
                </a>
                <a href="{{ path('cover_delete', {'id' : trick.id}) }}"
                   onclick="return confirm(`Êtes-vous sûr de vouloir supprimer l'image de couverture de la figure {{ trick.name }} ?`)">
                    <span class="far fa-trash-alt text-danger"></span>
                </a>
            </div>
        {% endif %}
        <a href="{{ asset('uploads/images/' ~ trick.coverImage) }}" target="_blank">
            <img style="height: 300px; width: 100%;" src="{{ asset('uploads/images/' ~ trick.coverImage) }}" alt="...">
        </a>
    </div>

    <div class="d-flex justify-content-around">
        <span class="badge badge-pill badge-info d-flex flex-column justify-content-center">Catégorie : {{ trick.category.name | capitalize }}</span>
        {% if trick.creator %}
        <span class="badge badge-pill badge-primary">
            Créateur :
            <img src="{{ trick.creator.profilePicture }}" class="avatar avatar-mini" alt="Avatar de {{ trick.creator.nickname }}">
            {{ trick.creator.nickname }}
        </span>
        {% endif %}
        <span class="badge badge-pill badge-success d-flex flex-column justify-content-center">Date de création : {{ trick.creationDate | date("d/m/Y à H:i:s") }}</span>
        {% if trick.modificationDate %}
            <span class="badge badge-pill badge-success d-flex flex-column justify-content-center">Dernière modification : {{ trick.modificationDate | date("d/m/Y à H:i:s") }}</span>
        {% endif %}
    </div>
    <hr>
    <p>{{ trick.description | capitalize }}</p>
    <hr>
    <div class="row d-flex justify-content-center">
    {% if trick.images | length > 0 %}
        {% for image in trick.images %}
            <div class="mx-3">
                <a href="{{ asset('uploads/images/' ~ image.name) }}" target="_blank">
                    <img style="height: 250px; width: 250px;" src="{{ asset('uploads/images/' ~ image.name) }}" alt="...">
                </a>
                {% if app.user %}
                <div class="d-flex justify-content-around">
                    <a href="{{ path('image_edit', {'id' : image.id}) }}">
                        <span class="fas fa-pencil-alt text-info"></span>
                    </a>
                    <a href="{{ path('image_delete', {'id' : image.id}) }}"
                       onclick="return confirm(`Êtes-vous sûr de vouloir supprimer cette image ?`)">
                        <span class="far fa-trash-alt text-danger"></span>
                    </a>
                </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
            {% set noImage = 'true' %}
    {% endif %}
    {% if trick.medias | length > 0 %}
        {% for media in trick.medias %}
            <div class="mx-3">
                <iframe width="250" height="250" src="{{ media.url }}" allowfullscreen></iframe>
                {% if app.user %}
                    <div class="d-flex justify-content-around">
                        <a href="{{ path('media_edit', {'id' : media.id}) }}">
                            <span class="fas fa-pencil-alt text-info"></span>
                        </a>
                        <a href="{{ path('media_delete', {'id' : media.id}) }}"
                           onclick="return confirm(`Êtes-vous sûr de vouloir supprimer cette vidéo ?`)">
                            <span class="far fa-trash-alt text-danger"></span>
                        </a>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        {% set noVideo = 'true' %}
    {% endif %}
    {% if noImage is defined and noVideo is defined %}
        Aucune vidéo ou image d'illustration actuellement.
    {% endif %}
    </div>
    <hr>
    <div class="mt-3">
        {% if app.user %}
            {{ form_start(form) }}
            {{ form_widget(form) }}
            {{ form_errors(form) }}
            <button type="submit" class="btn btn-primary">
                Poster votre commentaire
            </button>
            <div class="text-muted">(connecté(e) en tant que <strong>{{ app.user.nickname }}</strong>)</div>
            {{ form_end(form) }}
        {% else %}
        Pour écrire un commentaire, il faut vous <a href="{{ path('account_login') }}">identifier</a> ou vous
        <a href="{{ path('account_register') }}">inscrire</a> si vous ne possédez pas encore de compte !
        {% endif %}
    </div>
    <hr>
    <div class="mt-3">
    {% if trick.comments | length > 0 %}
        <span class="d-flex justify-content-center mb-2">
            Il y a actuellement {{ trick.comments | length }} commentaire{% if trick.comments | length > 1%}s{% endif%} concernant cette figure !
        </span>
        <div class="d-flex justify-content-center">
            {% set page = pagination.currentPage %}
            {% set pages = pagination.pages %}
            <ul class="pagination pagination-sm">
                <li class="page-item {% if page == 1 %}disabled{% endif %}">
                    <a class="page-link" href="{{ path('tricks_show', {'slug': trick.slug, 'page': page - 1}) }}">&laquo;</a>
                </li>
                {% for i in 1..pages %}
                <li class="page-item {% if i == page %}active{% endif %}">
                    <a class="page-link" href="{{ path('tricks_show', {'slug': trick.slug, 'page': i}) }}">{{ i }}</a>
                </li>
                {% endfor %}
                <li class="page-item {% if page == pages %}disabled{% endif %}">
                    <a class="page-link" href="{{ path('tricks_show', {'slug': trick.slug, 'page': page + 1}) }}">&raquo;</a>
                </li>
            </ul>
        </div>
        {% for comment in pagination.data %}
            {% if comment.author.nickname == trick.creator.nickname %}
                {% set authorIsCreator = 'true' %}
            {% else %}
                {% set authorIsCreator = 'false' %}
            {% endif %}
            <div class="card text-white bg-primary mb-3">
                <div class="card-header">
                    Posté le {{ comment.date | date('d/m/Y à H:i:s') }}
                    {% if authorIsCreator == 'true' %}
                        <span class="authorIsCreator">
                            (créateur de la figure)
                        </span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <h4 class="card-title">
                        {% if comment.author %}
                            <img src="{{ comment.author.profilePicture }}" class="avatar avatar-medium" alt="Avatar de {{ comment.author.nickname }}">
                            <span {% if authorIsCreator == 'true' %}class="authorIsCreator"{% endif %}>
                                {{ comment.author.nickname }}
                            </span>
                        {% else %}
                            Pseudo supprimé
                        {% endif %}
                    </h4>
                    <p class="card-text {% if authorIsCreator == 'true' %}authorIsCreator{% endif %}">
                        {{ comment.content }}
                    </p>
                </div>
            </div>
        {% endfor %}
    {% else %}
        Il n'y a actuellement aucun commentaire sur cette figure.
    {% endif %}
    </div>
</div>
{% endblock %}