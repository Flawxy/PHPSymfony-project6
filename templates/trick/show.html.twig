{% extends 'base.html.twig' %}

{% block title %}{{ trick.name | capitalize }}{% endblock %}

{% block body %}
<div class="container">
    {% if app.user %}
    <div class="mt-3">
        <a href="{{ path('tricks_edit', {'slug' : trick.slug}) }}" class="btn btn-warning">
            Modifier la figure
        </a>
        <a href="{{ path('tricks_delete', {'slug' : trick.slug}) }}" class="btn btn-danger"
        onclick="return confirm(`Êtes-vous sûr de vouloir supprimer la figure {{ trick.name }} ?`)">
            Supprimer la figure
        </a>
    </div>
    {% endif %}
    <h1>{{ trick.name | capitalize }}</h1>
    <img src="{{ trick.coverImage }}" alt="...">
    <p>{{ trick.description | capitalize }}</p>


    <span class="badge badge-pill badge-info">Catégorie : {{ trick.category.name | capitalize }}</span>
    {% if trick.creator %}
        <span class="badge badge-pill badge-primary">
            Créateur :
            <img src="{{ trick.creator.profilePicture }}" class="avatar avatar-mini" alt="Avatar de {{ trick.creator.nickname }}">
            {{ trick.creator.nickname }}
        </span>
        {% endif %}
        <span class="badge badge-pill badge-success d-flex flex-column justify-content-center">Date de création : {{ trick.creationDate | date("d/m/Y à H:i:s") }}</span>
        {% if trick.modificationDate %}
            <span class="badge badge-pill badge-success d-flex flex-column justify-content-center">Dernière modification : {{ trick.modificationDate | date("d/m/Y à H:i:s") }}</span>
        {% endif %}
    <hr>
    <p>{{ trick.description | capitalize }}</p>
    <hr>
    <div class="row d-flex justify-content-center">
    {% if trick.images | length > 0 %}
        {% for image in trick.images %}
            <div class="mx-3">
                <a href="{{ asset('uploads/images/' ~ image.name) }}" target="_blank">
                    <img style="height: 250px; width: 250px;" src="{{ asset('uploads/images/' ~ image.name) }}" alt="...">
                </a>
                {% if app.user %}
                <div class="d-flex justify-content-around">
                    <a href="{{ path('image_edit', {'id' : image.id}) }}">
                        <span class="fas fa-pencil-alt text-info"></span>
                    </a>
                    <a href="{{ path('image_delete', {'id' : image.id}) }}"
                       onclick="return confirm(`Êtes-vous sûr de vouloir supprimer cette image ?`)">
                        <span class="far fa-trash-alt text-danger"></span>
                    </a>
                </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
            {% set noImage = 'true' %}
    {% endif %}
    {% if trick.medias | length > 0 %}
        {% for media in trick.medias %}
            <div class="mx-3">
                <iframe width="250" height="250" src="{{ media.url }}" allowfullscreen></iframe>
                {% if app.user %}
                    <div class="d-flex justify-content-around">
                        <a href="{{ path('media_edit', {'id' : media.id}) }}">
                            <span class="fas fa-pencil-alt text-info"></span>
                        </a>
                        <a href="{{ path('media_delete', {'id' : media.id}) }}"
                           onclick="return confirm(`Êtes-vous sûr de vouloir supprimer cette vidéo ?`)">
                            <span class="far fa-trash-alt text-danger"></span>
                        </a>
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    {% else %}
        {% set noVideo = 'true' %}
    {% endif %}
    <span class="badge badge-pill badge-success">Date de création : {{ trick.creationDate | date("d/m/Y à H:i:s") }}</span>
    {% if trick.modificationDate %}
        <span class="badge badge-pill badge-success">Dernière modification : {{ trick.modificationDate | date("d/m/Y à H:i:s") }}</span>
    {% endif %}

    <div>
    {% for media in trick.medias %}
        {% if isMediaAnImage(media.url) %}
            <img src="{{ media.url }}" alt="..." />
            <figcaption>{{ media.caption }}</figcaption>
        {% else %}
        {{ media.url | raw }}
        <figcaption>{{ media.caption }}</figcaption>
        {% endif %}
    {% endfor %}
    </div>
    <hr>
    <div class="mt-3">
        {% if app.user %}
            {{ form_start(form) }}
            {{ form_widget(form) }}
            {{ form_errors(form) }}

            <button type="submit" class="btn btn-primary">
                Poster votre commentaire
            </button>
        {{ form_end(form) }}
        {% else %}
        Pour écrire un commentaire, il faut vous <a href="{{ path('account_login') }}">identifier</a> ou vous
        <a href="{{ path('account_register') }}">inscrire</a> si vous ne possédez pas encore de compte !
        {% endif %}
    </div>

    <div class="mt-3">
    {% if comments | length > 0 %}
        <span class="d-flex justify-content-center mb-2">
            Il y a actuellement {{ comments | length }} commentaire{% if comments | length > 1%}s{% endif%} concernant cette figure !
        </span>
        {% for comment in comments %}
            {% if comment.author.nickname == trick.creator.nickname %}
                {% set authorIsCreator = 'true' %}
            {% else %}
                {% set authorIsCreator = 'false' %}
            {% endif %}
            <div class="card text-white bg-primary mb-3">
                <div class="card-header">
                    Posté le {{ comment.date | date('d/m/Y à H:i:s') }}
                    {% if authorIsCreator == 'true' %}
                        <span class="authorIsCreator">
                            (créateur de la figure)
                        </span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <h4 class="card-title">
                        {% if comment.author %}
                            <img src="{{ comment.author.profilePicture }}" class="avatar avatar-medium" alt="Avatar de {{ comment.author.nickname }}">
                            <span {% if authorIsCreator == 'true' %}class="authorIsCreator"{% endif %}>
                                {{ comment.author.nickname }}
                            </span>
                        {% else %}
                            Pseudo supprimé
                        {% endif %}
                    </h4>
                    <p class="card-text {% if authorIsCreator == 'true' %}authorIsCreator{% endif %}">
                        {{ comment.content }}
                    </p>
                </div>
            </div>
        {% endfor %}
    {% else %}
        Il n'y a actuellement aucun commentaire sur cette figure.
    {% endif %}
    </div>
</div>
</div>
{% endblock %}